# Governance v2.5 Full Specification

> **Created:** 2026-01-06
> **Updated:** 2026-01-07 (v2.5.1 enhancements)
> **Status:** ACTIVE
> **Purpose:** Complete specification for v2.5 implementation (Plugin-Aware Governance)

---

## Table of Contents

| #    | Section                              | Purpose                                          |
|------|--------------------------------------|--------------------------------------------------|
| 1    | Executive Summary                    | v2 â†’ v2.5 evolution, what's new                    |
| 2    | Design Principles                    | v2.5 rules and philosophy                          |
| 3    | Core Concepts                        | Plugin awareness, directory intelligence         |
| 4    | 9-Layer Prompt System                | Unchanged from v2                                |
| 5    | Hook System                          | v2 + plugin cost tracking                        |
| 6    | Plugin Integration                   | NEW - Cost categories, recommendations           |
| 7    | Directory Intelligence               | NEW - CLAUDE_DIRECTORY_REFERENCE usage           |
| 8    | Per-Product Setup                    | FILICITI, FlowInLife, FILICITI_LABS              |
| 9    | Session Management                   | v2 + plugin tracking                             |
| 10   | Decision ID System                   | Unchanged from v2                                |
| 11   | Scripts & Tools                      | v2 + new guides                                  |
| 12   | Migration from V2                    | Backward compatible upgrade path                 |
| 13   | Quick Reference                      | v2.5 commands and workflows                        |

---

## 1. Executive Summary

### 1.1 v2 Summary (What We Had)

| Component           | v2 Approach                                  |
|---------------------|----------------------------------------------|
| Enforcement         | Hooks enforce (exit 2 = block)               |
| Session capture     | `cc` wrapper auto-records                    |
| Warm-up             | `Stop` hook timer                            |
| Boundaries          | Minimal CLAUDE.md (~25 lines)                |
| Session logs        | `~/.claude/history.jsonl`                    |
| Plan sync           | `~/.claude/plans/*.md` (auto)                |
| Prompt layers       | 9-layer system (global â†’ project)            |
| Decision tracking   | Decision IDs (#G, #P, #I, #S, #B)            |

**v2 Achievements:**
- âœ… Automated session capture
- âœ… Hook enforcement (blocking violations)
- âœ… Minimal prompt context
- âœ… Auto-generated session summaries
- âœ… Company-level vs per-project governance

### 1.2 What Was Missing in v2

| Gap                              | Impact                                       |
|----------------------------------|----------------------------------------------|
| No plugin awareness              | Unclear which plugins to install             |
| No cost tracking                 | High-cost plugins inflate token usage        |
| No per-product guidance          | Each project starts from scratch             |
| No tech stack intelligence       | Can't recommend plugins based on stack       |
| Directory reference unused       | Project structure knowledge scattered        |

### 1.3 The Solution: v2.5

**Core Concept: Plugin-Aware Governance**

| v2 Gap                   | v2.5 Solution                                    |
|--------------------------|------------------------------------------------|
| No plugin awareness      | Plugin cost categories (Zero/Low/Medium/High)  |
| No cost tracking         | SessionStart hook shows active plugins + cost  |
| No per-product guidance  | Per-product recommended_plugins.md files       |
| No tech stack intel      | Detected from files (LSPs auto-activate)       |
| Directory ref unused     | Referenced in guides, not auto-injected        |

**What Changes in v2.5:**
1. âœ… Add plugin cost tracking to SessionStart hook
2. âœ… Create per-product plugin recommendation lists
3. âœ… Keep CLAUDE_DIRECTORY_REFERENCE as reference manual (not auto-inject)
4. âœ… Add plugin selection guide
5. âœ… Maintain v2 features (9-layer prompt, hooks, minimal CLAUDE.md)

**What Stays from v2:**
- âœ… All hooks (SessionStart, PreToolUse, PostToolUse, Stop)
- âœ… `cc` wrapper for terminal capture
- âœ… Minimal CLAUDE.md approach
- âœ… 9-layer prompt system
- âœ… Decision ID system
- âœ… Scripts (audit, test, watch, sync)

### 1.4 Key Decisions

| ID   | Decision                                                  |
|------|-----------------------------------------------------------|
| #G40 | Evolution approach (v2.5 builds on v2, no breaking changes) |
| #G41 | Plugin cost tracking in SessionStart hook                 |
| #G42 | Per-product plugin recommendation files                   |
| #G43 | High-cost plugins globally discouraged (not banned)       |
| #G44 | CLAUDE_DIRECTORY_REFERENCE as reference manual           |
| #G45 | LSPs auto-install by Claude Code (no forced installs)    |
| #G46 | Simplify status bar to essential information only (v2.5.1)|
| #G47 | Use git commands, not .git directory checks (v2.5.1)     |
| #G48 | Layer 3 (global) overrides Layer 2 (project) (v2.5.1)    |
| #G49 | Avoid CLAUDE.md symlinks, create project-specific (v2.5.1)|
| #G50 | Document symlinks in project CLAUDE.md if used (v2.5.1)  |

---

## 2. Design Principles

### 2.1 v2.5 Rules (Build on v2)

| Priority | Principle                                                |
|----------|----------------------------------------------------------|
| 1        | **Backward compatible** - v2 projects work unchanged     |
| 2        | **Plugin awareness** - Guide plugin selection per stack  |
| 3        | **Cost transparency** - Show plugin cost at session start|
| 4        | **Minimal prompt context** - Don't auto-inject large docs|
| 5        | **Per-product guidance** - Tech stack-specific recs      |
| 6        | **Evolution not revolution** - Keep what works from v2   |

### 2.2 Key Shift (v2 â†’ v2.5)

| v2                                | v2.5                                           |
|-----------------------------------|----------------------------------------------|
| Plugin-agnostic                   | Plugin-aware governance                      |
| No plugin cost visibility         | SessionStart shows installed plugins + cost  |
| No per-product guidance           | Per-product recommended_plugins.md files     |
| Directory ref dormant             | Directory ref as reference manual            |
| Global hooks only                 | Global hooks + per-product plugin guides     |

---

## 3. Core Concepts

### 3.1 Plugin-Aware Governance

**Definition:** Governance system that understands Claude Code plugins and helps users make informed installation decisions based on cost, tech stack, and project needs.

**Key Components:**

1. **Plugin Cost Categories**
   - **Zero (idle)**: 28 plugins - No cost when not invoked (LSPs, external plugins)
   - **âœ“ Low**: 5 plugins - Minimal token usage (simple commands/hooks)
   - **âš™ï¸ Medium**: 3 plugins - Multi-agent workflows (only when invoked)
   - **âš ï¸ High (always active)**: 3 plugins - Output styling with large prompts

2. **Cost Tracking**
   - SessionStart hook checks `~/.claude/plugins/installed_plugins.json`
   - Warns if high-cost plugins active (1000+ tokens/session)
   - Shows total plugin count

3. **Per-Product Recommendations**
   - `~/Desktop/FILICITI/.claude/recommended_plugins.md` (Next.js + FastAPI)
   - `~/Desktop/FlowInLife_env/.claude/recommended_plugins.md` (React Native + PHP)
   - Tech stack-specific LSP recommendations

4. **Plugin Selection Guide**
   - `~/Desktop/Governance/guides/plugin_selection.md`
   - When to use feature-dev vs code-review
   - Installation scopes (User/Project/Local)
   - Common use cases

### 3.2 Directory Intelligence

**Definition:** Using CLAUDE_DIRECTORY_REFERENCE_v2.md as a reference manual (not auto-injected) to understand project structures and inform plugin recommendations.

**Key Components:**

1. **Reference Manual Approach**
   - Lives in `~/Desktop/Governance/CLAUDE_DIRECTORY_REFERENCE_v2.md`
   - 109KB, too large to auto-inject (context bloat)
   - Cross-referenced from guides when needed
   - Consulted during project onboarding

2. **When to Use**
   - Setting up new product
   - Understanding folder hierarchy
   - Deciding where to place `.claude/` folders
   - Choosing Product vs Project vs Global layers

3. **What It Provides**
   - Complete Desktop directory tree
   - Project type identification
   - Tech stack summaries
   - Symlink governance strategy

### 3.3 Layered Configuration (v2 Concept, Enhanced in v2.5)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 3: GLOBAL (~/.claude/CLAUDE.md)                      â”‚
â”‚  - Universal rules (date format, table formatting)          â”‚
â”‚  - Plugin cost awareness (NEW in v2.5)                        â”‚
â”‚  - Global conventions                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 2: PRODUCT (~/Desktop/FILICITI/.claude/)             â”‚
â”‚  - Product-level boundaries                                 â”‚
â”‚  - Recommended plugins (NEW in v2.5)                          â”‚
â”‚  - Product workflows                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 1: PROJECT (~/Desktop/FILICITI/code/CLAUDE.md)       â”‚
â”‚  - Project boundaries (CAN/CANNOT modify)                   â”‚
â”‚  - Tech stack plugins (NEW in v2.5)                           â”‚
â”‚  - Current task context                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. 9-Layer Prompt System

**Status:** Unchanged from v2

See `V2_FULL_SPEC.md` Section 5 for complete documentation.

**Quick Reference:**

| Layer | Source                          | Priority | Example                    |
|-------|---------------------------------|----------|----------------------------|
| 1     | Project CLAUDE.md               | Highest  | Boundaries, project rules  |
| 2     | Product CLAUDE.md (if exists)   | High     | Product-level rules        |
| 3     | Global CLAUDE.md                | Medium   | Universal rules            |
| 4     | Hook-injected context           | High     | Date, boundaries (dynamic) |
| 5     | Claude Code system prompt       | Baseline | Tool usage, workflows      |
| 6     | User message                    | Trigger  | Current task               |
| 7     | Conversation history            | Context  | Previous exchanges         |
| 8     | Tool results                    | Evidence | File contents, outputs     |
| 9     | Plugin prompts                  | **NEW**  | Plugin-specific instructions|

**NEW in v2.5:** Layer 9 - Plugin prompts (e.g., output styling plugins add instructions)

---

## 5. Hook System

**Status:** Enhanced from v2 with plugin tracking

### 5.1 Existing Hooks (from v2)

| Hook           | Trigger          | Purpose                              | File                   |
|----------------|------------------|--------------------------------------|------------------------|
| SessionStart   | Session begins   | Inject date, boundaries, context     | inject_context.sh      |
| PreToolUse     | Before tool call | Check boundaries, log intent         | check_boundaries.sh    |
| PostToolUse    | After tool call  | Log actions, verify no violations    | log_tool_use.sh        |
| Stop           | Session idle     | Warn after 90 minutes                | check_warmup.sh        |

### 5.2 NEW in v2.5: Enhanced SessionStart Hook

**File:** `~/Desktop/Governance/hooks/inject_context.sh`

**New Addition (lines 50-70):**

```bash
# Plugin cost tracking (v2.5)
if [ -f "$HOME/.claude/plugins/installed_plugins.json" ]; then
    HIGH_COST_PLUGINS=$(jq -r '.plugins[] | select(.name | test("output-style|ralph-wiggum")) | .name' "$HOME/.claude/plugins/installed_plugins.json" 2>/dev/null | wc -l | tr -d ' ')

    if [ "$HIGH_COST_PLUGINS" -gt 0 ]; then
        echo "âš ï¸  WARNING: $HIGH_COST_PLUGINS high-cost plugin(s) active (adds 1000+ tokens/session)"
    fi

    TOTAL_PLUGINS=$(jq -r '.plugins | length' "$HOME/.claude/plugins/installed_plugins.json" 2>/dev/null)
    echo "ğŸ”Œ Plugins: $TOTAL_PLUGINS installed"
fi
```

**What It Does:**
1. Checks if any high-cost plugins are installed (output-style, ralph-wiggum)
2. Warns user if high-cost plugins active (1000+ tokens per session)
3. Shows total plugin count

**Example Output (v2.5.0):**
```
ğŸ“… Date: 2026-01-06 Â· ğŸ“ Project: FILICITI Â· âœ… CAN: code/ Â· ğŸš« CANNOT: /Volumes/ Â· ğŸ”§ Hooks: 6 Â· ğŸ”Œ Plugins: 37 installed
```

**Note:** This is the SessionStart HOOK output (from inject_context.sh), which is different from the status bar shown above. The hook runs once at session start and injects this context. The status bar is continuously shown by Claude Code.

### 5.3 NEW in v2.5.1: Simplified Status Bar

**Status:** âœ… Implemented (hooks updated 2026-01-07)

**Status Bar Script:** `scripts/suggest_model.sh` (custom, not Claude Code built-in)

**Before v2.5.1:**
```
Model: [?] Â· No todos Â· ğŸŸ¢ Hooks: 6 Â· ğŸŸ¢ Context: ~87K (uncalibrated) Â· ğŸ”´ Warmup: 527m Â·Â· Confirm model (/status) Â· Check /context Â· (+2)
```

**Components (v2.5.0):**
- Model: Currently selected model (Sonnet/Opus/Haiku)
- Todos: Todo count from TodoWrite tool
- Hooks: Active hooks count with status indicator
- Context: Token usage estimate with calibration status
- Warmup: Time since last session (minutes)
- Action prompts: Suggestions for user actions
- (+2): Additional info available

**Simplification Changes (v2.5.1):**

| Component       | Current Status           | v2.5.1 Change                        | Reason                              |
|-----------------|--------------------------|--------------------------------------|-------------------------------------|
| Model           | âœ… Shown (Model: [?])    | **Remove**                           | Not user-controllable in practice   |
| Todos           | âœ… Shown (count)         | **Remove**                           | Not status bar concern              |
| Hooks           | âœ… Shown (ğŸŸ¢ Hooks: 6)   | **Remove**                           | Rarely changes, low value           |
| Context         | âœ… Shown (ğŸŸ¢ Context: ~XK)| **Keep & Fix**                       | Essential, fix calibration          |
| Warmup          | âœ… Shown (ğŸ”´ Warmup: Xm) | **Keep & Improve**                   | Show Ready/Not ready instead of min |
| Action prompts  | âœ… Shown                 | **Remove**                           | Clutters status bar                 |
| Plugins         | âŒ Not shown             | **Add** (ğŸ”Œ Plugins: X)              | Plugin awareness                    |
| Active Plugin   | âŒ Not shown             | **Add** (ğŸ”µ Active: plugin-name)     | See which plugin running            |

**v2.5.1 Format (implemented):**
```
ğŸŸ¢ Context: ~15K (calibrated) Â· âœ… Warmup: 45m Â· ğŸ”Œ Active Plugins: none
```

**When automatic plugin active:**
```
ğŸŸ¢ Context: ~15K (calibrated) Â· âœ… Warmup: 45m Â· ğŸ”Œ Active Plugins: frontend-design
```

**When multiple plugins active:**
```
ğŸŸ¢ Context: ~15K (calibrated) Â· âš ï¸ Warmup: 320m Â· ğŸ”Œ Active Plugins: security-guidance, frontend-design
```

**Example actual output:**
```
ğŸ”´ Context: ~191K (uncalibrated) Â· ğŸ”´ Warmup: 902m Â· ğŸ”Œ Active Plugins: none
```

**Component Details:**

| Component       | Format                          | Logic                                      |
|-----------------|---------------------------------|--------------------------------------------|
| Context         | `ğŸŸ¢ Context: ~XK (calibrated)`  | Show calibration status (calibrated/uncalibrated) |
| Warmup          | `âœ… Warmup: Xm`                 | Show minutes since last session, color by threshold: âœ… <240m, âš ï¸ 240-480m, ğŸ”´ >480m |
| Active Plugins  | `ğŸ”Œ Active Plugins: name[,name]`| Show currently executing automatic plugins, "none" if none active |

**Warmup Color Logic:**
- âœ… Green: <240m (4h) - Fresh session context
- âš ï¸ Yellow: 240-480m (4-8h) - Context getting stale
- ğŸ”´ Red: >480m (8h+) - Cold start, needs warm-up

**Implementation Notes:**
- Context: Show "(calibrated)" or "(uncalibrated)" based on context_factor in session state
- Warmup: Keep minutes format (simpler than Ready/Stale/Cold), color by threshold
- Active Plugins: Detect from PreToolUse hook execution, show comma-separated list or "none"
- Separator: Use centered dot (Â·)
- Remove: Model, Todos, Hooks count, Action prompts

**Decision ID:** #G46 - Simplify status bar to essential information only

### 5.4 v2.5.1 Hook & Script Updates

**Status:** âœ… Implemented (2026-01-07)

**Updated Files:**

| File                  | Changes                                          | Type                   |
|-----------------------|--------------------------------------------------|------------------------|
| inject_context.sh     | Centered dots (Â·), hooks only shown if errors   | SessionStart hook      |
| check_boundaries.sh   | Allow ~/.claude/* (sessions, plans, etc.)       | PreToolUse hook        |
| suggest_model.sh      | Simplified status bar (removed Model/Todos/Hooks/Recs) | Status bar script |

**inject_context.sh Changes:**
```bash
# Before (v2.5.0):
"ğŸ“… Date: $DATE | ğŸ“ Project: $PROJECT | ... | ğŸ”§ Hooks: 6 | ğŸ”Œ Plugins: 37 installed"

# After (v2.5.1):
"ğŸ“… Date: $DATE Â· ğŸ“ Project: $PROJECT Â· ... Â· ğŸ”Œ Plugins: 37"
# Hooks only shown if errors: " Â· âš ï¸ Hooks: 6 (2 errors)"
```

**check_boundaries.sh Changes:**
```bash
# Added early exit for ~/.claude/* files:
if [[ "$FILE" == "$HOME/.claude/"* ]]; then
    exit 0  # Allow system files
fi
```

**suggest_model.sh Changes:**
```bash
# Before (v2.5.0):
"Model: [?] | No todos | ğŸŸ¢ Hooks: 6 | ğŸŸ¢ Context: ~87K (uncalibrated) | ğŸ”´ Warmup: 527m || Confirm model (/status)"

# After (v2.5.1):
"ğŸŸ¢ Context: ~15K (calibrated) Â· âœ… Warmup: 45m Â· ğŸ”Œ Active Plugins: none"
```

**Why These Changes:**
- Centered dots (Â·) more readable than pipes (|)
- Removed Model, Todos, Hooks, Recommendations (low value, cluttered)
- Keep Context (essential) with calibration status
- Keep Warmup with color-coded thresholds (âœ… <4h, âš ï¸ 4-8h, ğŸ”´ >8h)
- Added Active Plugins to see what automatic plugins are running
- Allow ~/.claude/sessions/ for session state management (#G46)
- Cleaner, less cluttered output

---

## 6. Plugin Integration

### 6.1 Plugin Cost Categories

**Reference:** See `CLAUDE_PLUGINS_REFERENCE.md` for complete plugin documentation (133KB, 41 plugins).

| Cost      | Count | Examples                                | When Active         |
|-----------|-------|-----------------------------------------|---------------------|
| Zero      | 28    | LSPs, context7, github, supabase        | Only when invoked   |
| âœ“ Low     | 5     | commit-commands, security-guidance      | Minimal always-on   |
| âš™ï¸ Medium | 3     | feature-dev, code-review, pr-review     | Only when invoked   |
| âš ï¸ High   | 3     | explanatory-output-style, learning, ralph | Always active       |

**Policy:**
- âœ… Install all **Zero** and **Low** cost plugins freely
- âš™ï¸ Install **Medium** cost plugins on-demand (only use when needed)
- âš ï¸ **Avoid High** cost plugins unless absolutely necessary (max 1 at a time)

### 6.2 Per-Product Plugin Recommendations

#### 6.2.1 FILICITI/COEVOLVE

**Tech Stack:**
- Frontend: Next.js 13, React 18, TypeScript 5.4
- Backend: FastAPI (Python 3.13), SQLAlchemy
- Database: PostgreSQL 15, Redis
- AI: OpenAI GPT-4

**Recommended Plugins:**

| Plugin          | Type     | Cost  | When to Use                      |
|-----------------|----------|-------|----------------------------------|
| typescript-lsp  | LSP      | Zero  | Always (auto-activates)          |
| pyright-lsp     | LSP      | Zero  | Always (auto-activates)          |
| github          | External | Zero  | Version control operations       |
| context7        | External | Zero  | AI documentation lookup          |
| feature-dev     | Internal | Med   | Building new features            |
| code-review     | Internal | Med   | Before merging PRs               |

**File:** `~/Desktop/FILICITI/.claude/recommended_plugins.md`

#### 6.2.2 FlowInLife

**Tech Stack:**
- Frontend: React 18.3, React Native 0.77, TypeScript 5.0
- Backend: PHP/Swoole + Python/Flask (YutaAI)
- Database: MySQL, Redis, OpenSearch

**Recommended Plugins:**

| Plugin          | Type     | Cost  | When to Use                      |
|-----------------|----------|-------|----------------------------------|
| typescript-lsp  | LSP      | Zero  | Always (React + React Native)    |
| php-lsp         | LSP      | Zero  | Always (Swoole backend)          |
| pyright-lsp     | LSP      | Zero  | Always (YutaAI backend)          |
| github          | External | Zero  | Version control                  |
| context7        | External | Zero  | Documentation                    |
| code-review     | Internal | Med   | Pre-merge review                 |

**File:** `~/Desktop/FlowInLife_env/.claude/recommended_plugins.md`

### 6.3 Plugin Selection Guide

**File:** `~/Desktop/Governance/guides/plugin_selection.md`

**Contents:**
1. Plugin Cost Categories (Zero/Low/Medium/High)
2. Installation Strategy (User/Project/Local scopes)
3. Per-Tech-Stack Recommendations
4. Common Use Cases (when to use feature-dev vs code-review)
5. Plugin Discovery Workflow

**Key Questions to Ask:**
- What's my tech stack? â†’ Install matching LSPs (zero cost)
- Am I working alone or with team? â†’ Local vs Project scope
- Do I need output styling? â†’ Consider cost (1000+ tokens/session)
- Building a new feature? â†’ Use feature-dev (medium cost, only when needed)
- Reviewing code? â†’ Use code-review (medium cost, only when needed)

---

## 7. Directory Intelligence

### 7.1 CLAUDE_DIRECTORY_REFERENCE Usage

**File:** `~/Desktop/Governance/CLAUDE_DIRECTORY_REFERENCE_v2.md` (109KB)

**Status:** Reference manual (not auto-injected)

**When to Consult:**
1. Setting up new product
2. Understanding project hierarchy
3. Deciding where to place `.claude/` folders
4. Choosing Product vs Project vs Global layers
5. Onboarding new team members

**Why Not Auto-Inject:**
- 109KB file (too large for every session)
- Context bloat (wastes tokens)
- Rarely needed after initial setup
- Better as reference manual

**How to Use:**
1. Cross-referenced from guides (plugin_selection.md, per_product_setup.md)
2. Consulted when user asks about project structure
3. Read on-demand when setting up new projects

### 7.2 Cross-References

**In Global CLAUDE.md:**
```markdown
## Links

- Governance: `~/Desktop/Governance/`
- Full spec: `~/Desktop/Governance/V2.5_FULL_SPEC.md`
- Plugin reference: `~/Desktop/Governance/CLAUDE_PLUGINS_REFERENCE.md`
- Directory reference: `~/Desktop/Governance/CLAUDE_DIRECTORY_REFERENCE_v2.md`
```

**In Per-Product recommended_plugins.md:**
```markdown
## See Also

- [Plugin Selection Guide](~/Desktop/Governance/guides/plugin_selection.md)
- [Directory Reference](~/Desktop/Governance/CLAUDE_DIRECTORY_REFERENCE_v2.md)
```

---

## 8. Per-Product Setup

### 8.1 Product vs Project vs Global Layers

```
~/.claude/                          # GLOBAL (User Scope)
â”œâ”€â”€ CLAUDE.md                       # Layer 3: Global rules
â”œâ”€â”€ plugins/                        # All installed plugins
â”‚   â””â”€â”€ installed_plugins.json     # Current: 37 plugins
â””â”€â”€ settings.json                   # Hook configuration

~/Desktop/FILICITI/                # PRODUCT Level
â”œâ”€â”€ .claude/
â”‚   â”œâ”€â”€ CLAUDE.md                  # Layer 2: Product rules (optional)
â”‚   â””â”€â”€ recommended_plugins.md     # NEW in v2.5
â””â”€â”€ Products/COEVOLVE/code/        # PROJECT Level
    â””â”€â”€ CLAUDE.md                  # Layer 1: Project boundaries
```

### 8.2 FILICITI Setup

**Product:** AI workflow automation platform (COEVOLVE)

**Structure:** Monorepo with frontend + backend

**Setup Steps:**
1. Create `~/Desktop/FILICITI/.claude/recommended_plugins.md`
2. Reference tech stack (Next.js + FastAPI)
3. List recommended plugins (typescript-lsp, pyright-lsp, github, context7)
4. Update project CLAUDE.md with boundaries

**Files to Create:**
- `~/Desktop/FILICITI/.claude/recommended_plugins.md` âœ…

**Files to Update:**
- None (project CLAUDE.md already exists)

### 8.3 FlowInLife Setup

**Product:** Production SaaS with web + mobile

**Structure:** Monorepo with React/React Native + PHP/Python

**Setup Steps:**
1. Create `~/Desktop/FlowInLife_env/.claude/recommended_plugins.md`
2. Reference tech stack (React Native + PHP + Python)
3. List recommended plugins (typescript-lsp, php-lsp, pyright-lsp)
4. Update project CLAUDE.md if needed

**Files to Create:**
- `~/Desktop/FlowInLife_env/.claude/recommended_plugins.md` âœ…

### 8.4 FILICITI_LABS Setup

**Products:** 2 independent projects
1. COEVOLVE (technical) - same as FILICITI
2. COEVOLVE_businessplan (business/GTM) - Markdown only, no special plugins

**Setup Steps:**
- No separate setup needed (uses FILICITI recommendations)
- Businessplan project: No plugins needed (Markdown documentation)

### 8.5 New Product Onboarding Checklist

**File:** `~/Desktop/Governance/guides/per_product_setup.md`

**Steps:**
1. [ ] Identify tech stack (languages, frameworks, databases)
2. [ ] Create product `.claude/` folder
3. [ ] Create `recommended_plugins.md` file
4. [ ] List always-active plugins (LSPs for your stack)
5. [ ] List on-demand plugins (github, context7, feature-dev, code-review)
6. [ ] Optional: Create product CLAUDE.md (Layer 2) if needed
7. [ ] Test: Start session, verify plugins listed in SessionStart hook

---

## 9. Session Management

**Status:** Enhanced from v2 with plugin tracking

### 9.1 SessionStart Output (NEW in v2.5)

**Before v2.5:**
```
ğŸ“… Date: 2026-01-06 | ğŸ“ Project: FILICITI | âœ… CAN: code/ | ğŸš« CANNOT: /Volumes/ | ğŸ”§ Hooks: 6
```

**After v2.5:**
```
ğŸ“… Date: 2026-01-06 | ğŸ“ Project: FILICITI | âœ… CAN: code/ | ğŸš« CANNOT: /Volumes/ | ğŸ”§ Hooks: 6 | ğŸ”Œ Plugins: 37 installed
```

**If high-cost plugins active:**
```
âš ï¸  WARNING: 1 high-cost plugin(s) active (adds 1000+ tokens/session)
ğŸ“… Date: 2026-01-06 | ğŸ“ Project: FILICITI | âœ… CAN: code/ | ğŸš« CANNOT: /Volumes/ | ğŸ”§ Hooks: 6 | ğŸ”Œ Plugins: 38 installed
```

### 9.2 Plugin Management Workflow

**Check installed plugins:**
```bash
/plugin
```

**Install plugin:**
```bash
# Via Claude Code UI: Discover plugins tab
```

**Uninstall plugin:**
```bash
# Via Claude Code UI: Installed plugins â†’ Uninstall
```

**Check plugin cost before installing:**
- Consult `~/Desktop/Governance/CLAUDE_PLUGINS_REFERENCE.md`
- Look at "Complete Plugin Inventory" table (lines 3810-3852)
- Check "Cost" column (Zero / âœ“ Low / âš™ï¸ Medium / âš ï¸ High)

---

## 10. Decision ID System

**Status:** Unchanged from v2

See `V2_FULL_SPEC.md` Section 15 for complete documentation.

**Quick Reference:**

| ID | Scope      | Example                              |
|----|------------|--------------------------------------|
| #G | Governance | #G40 Evolution approach              |
| #P | Process    | #P12 Code review before merge        |
| #I | Issue      | #I456 Bug in authentication          |
| #S | Script     | #S10 Audit script                    |
| #B | Backup     | #B20 Weekly backup policy            |

**NEW Decision IDs:**
- v2.5: #G40 through #G45 (see Section 1.4)
- v2.5.1: #G46 through #G50 (see Section 1.4)

---

## 11. Scripts & Tools

**Status:** v2 scripts unchanged, new guides added

### 11.1 Existing Scripts (from v2)

| Script                      | Purpose                                  | Location              |
|-----------------------------|------------------------------------------|-----------------------|
| `governance_audit.sh`       | Verify governance setup                  | `scripts/`            |
| `governance_test.sh`        | Test hooks functionality                 | `scripts/`            |
| `governance_watch.sh`       | Monitor CLAUDE.md changes                | `scripts/`            |
| `governance_claude_sync.sh` | Sync to Claude env                       | `scripts/`            |
| `governance_report.sh`      | Generate governance report               | `scripts/`            |
| `prompt_monitor.sh`         | Monitor prompt context size              | `scripts/`            |

### 11.2 NEW Guides (v2.5)

| Guide                             | Purpose                                  | Location              |
|-----------------------------------|------------------------------------------|-----------------------|
| `plugin_selection.md`             | How to choose plugins                    | `guides/`             |
| `per_product_setup.md`            | Product setup guide                      | `guides/`             |
| `migration_v2_to_v2.5.md`         | Migration guide                          | `guides/`             |
| `implementation_best_practices.md`| Implementation gaps and solutions (v2.5.1)| `guides/`            |

---

## 12. Migration from V2

### 12.1 Breaking Changes

**NONE** - v2.5 is fully backward compatible with v2.

**What This Means:**
- All v2 projects work unchanged in v2.5
- No mandatory file updates
- No hook changes required
- All v2 scripts still work

### 12.2 Optional Upgrades

**If you want v2.5 features, perform these optional upgrades:**

1. **Global CLAUDE.md** (add plugin awareness)
   - Add 2 new rules (plugin cost warning, plugin recommendations link)
   - See Section 12.3 below

2. **SessionStart Hook** (add plugin tracking)
   - Add 20 lines to `inject_context.sh`
   - See Section 5.2 above

3. **Per-Product Plugin Guides**
   - Create `recommended_plugins.md` for each product
   - See Section 8 above

4. **Governance CLAUDE.md** (reference v2.5)
   - Update version reference to v2.5
   - Link to V2.5_FULL_SPEC.md

### 12.3 Global CLAUDE.md Update

**File:** `~/.claude/CLAUDE.md`

**Add these 2 rules:**

```markdown
## Plugin Cost Awareness (NEW in v2.5)

11. **High-cost plugins warning**: Avoid output styling plugins (explanatory-output-style, learning-output-style, ralph-wiggum) unless absolutely necessary
    - These add 1000+ tokens per session
    - Only install ONE at a time maximum
    - Check `/plugin` to verify active plugins

12. **Plugin recommendations**: See ~/Desktop/Governance/guides/plugin_selection.md for:
    - Zero-cost plugins (safe to install anytime)
    - Per-project plugin recommendations
    - Tech stack-specific plugins
```

**Update version reference:**

```markdown
## Links

- Governance: `~/Desktop/Governance/`
- Full spec: `~/Desktop/Governance/V2.5_FULL_SPEC.md`  â† Updated from V2
```

### 12.4 Rollback Instructions

**If you need to rollback to v2:**

1. Remove 2 new rules from `~/.claude/CLAUDE.md` (rules 11-12)
2. Remove plugin tracking from `inject_context.sh` (lines 50-70)
3. Delete per-product `recommended_plugins.md` files
4. Revert Governance CLAUDE.md to reference V2_FULL_SPEC.md

**No data loss** - all v2 features remain intact.

---

## 13. Quick Reference

### 13.1 v2.5 Commands

**Check installed plugins:**
```bash
/plugin
```

**View plugin cost before installing:**
```bash
# In Claude Code:
# 1. Open ~/Desktop/Governance/CLAUDE_PLUGINS_REFERENCE.md
# 2. Search for plugin name
# 3. Check "Cost" column in inventory table (line 3810+)
```

**Check session plugin count:**
```bash
# Start new session â†’ SessionStart hook shows plugin count
# Example: "ğŸ”Œ Plugins: 37 installed"
```

**Review per-product recommendations:**
```bash
# FILICITI:
cat ~/Desktop/FILICITI/.claude/recommended_plugins.md

# FlowInLife:
cat ~/Desktop/FlowInLife_env/.claude/recommended_plugins.md
```

### 13.2 v2.5 File Locations

| File                          | Location                                                   |
|-------------------------------|------------------------------------------------------------|
| V2.5 Spec                     | `~/Desktop/Governance/V2.5_FULL_SPEC.md`                   |
| Plugin Reference              | `~/Desktop/Governance/CLAUDE_PLUGINS_REFERENCE.md`         |
| Directory Reference           | `~/Desktop/Governance/CLAUDE_DIRECTORY_REFERENCE_v2.md`    |
| Plugin Selection Guide        | `~/Desktop/Governance/guides/plugin_selection.md`          |
| Per-Product Setup Guide       | `~/Desktop/Governance/guides/per_product_setup.md`         |
| Migration Guide               | `~/Desktop/Governance/guides/migration_v2_to_v2.5.md`      |
| Implementation Best Practices | `~/Desktop/Governance/guides/implementation_best_practices.md` |
| FILICITI Plugin Recs          | `~/Desktop/FILICITI/.claude/recommended_plugins.md`        |
| FlowInLife Plugin Recs        | `~/Desktop/FlowInLife_env/.claude/recommended_plugins.md`  |

### 13.3 Key v2.5 Decisions Quick Ref

| Decision | Summary                                              |
|----------|------------------------------------------------------|
| #G40     | Evolution approach (build on v2, no breaking changes)|
| #G41     | Plugin cost tracking in SessionStart hook            |
| #G42     | Per-product plugin recommendation files              |
| #G43     | High-cost plugins globally discouraged (not banned)  |
| #G44     | CLAUDE_DIRECTORY_REFERENCE as reference manual       |
| #G45     | LSPs auto-install by Claude Code (no forced installs)|
| #G46     | Simplify status bar (v2.5.1)                         |
| #G47     | Use git commands, not .git checks (v2.5.1)           |
| #G48     | Layer 3 overrides Layer 2 (v2.5.1)                   |
| #G49     | Avoid CLAUDE.md symlinks (v2.5.1)                    |
| #G50     | Document symlinks if used (v2.5.1)                   |

### 13.4 Daily Workflows

#### Day Start Workflow

**For all projects:**
```bash
1. Open terminal in project directory
2. Start Claude Code session
3. Review SessionStart hook output:
   - Date confirmation (2026-01-07)
   - Boundaries (CAN/CANNOT modify)
   - Context estimate (~XK tokens)
   - Plugins count (X installed)
   - Warmup status (âœ… or âš ï¸)
4. If new to project: Read project CLAUDE.md
5. If continuing work: Read previous session handoff
```

**Warm-up process (first session of day):**
```bash
# If status shows: âš ï¸ Warmup: Not ready (last: 5h ago)
# Run warm-up workflow:

1. Read project CLAUDE.md (refresh boundaries)
2. Review recent git history:
   git log --oneline -5
3. Check current branch:
   git status
4. Read previous session handoff (if exists):
   cat .claude/session_handoffs/YYYY-MM-DD_handoff.md
5. Warmup status updates to: âœ… Warmup: Ready
```

**Connection to Governance docs:**
```bash
# All projects reference Governance hub:
# - Global rules: ~/.claude/CLAUDE.md
# - Full spec: ~/Desktop/Governance/V2.5_FULL_SPEC.md
# - Plugin reference: ~/Desktop/Governance/CLAUDE_PLUGINS_REFERENCE.md

# Check global rules if needed:
cat ~/.claude/CLAUDE.md
```

#### Daily Work Workflow (Code Projects)

**For FILICITI/COEVOLVE:**
```bash
1. Create feature list document (if starting new work):
   - List features to build
   - Priority order
   - Acceptance criteria

2. Feature development loop:
   /feature-dev [Build feature description]
   # - Auto-runs 7 phases (Discovery â†’ Summary)
   # - Includes testing in Phase 6
   # - Outputs feature review

3. Save progress:
   /commit
   # - Auto-generates commit message
   # - Commits to current branch

4. Repeat steps 2-3 for more features

5. Optional: Pre-PR test coverage check (high-stakes features):
   "Run pr-test-analyzer"
   # - Checks test coverage quality
   # - Identifies gaps

6. Create pull request:
   /commit-push-pr
   # - Pushes to remote
   # - Creates PR with auto-generated description

7. Review entire PR:
   /code-review
   # - Reviews how all features interact
   # - Confidence scoring (80+ threshold)

8. Fix issues from review:
   Fix code â†’ /commit
   Repeat until review passes

9. Merge PR

10. Post-merge (if external plugins configured):
    # Automatic via integrations:
    # - vercel: Auto-deploy
    # - sentry: Monitor errors
```

#### Daily Work Workflow (Documentation Projects)

**For Governance:**
```bash
1. Edit .md files directly

2. Save progress:
   /commit
   # - Auto-generates descriptive commit message
   # - Follows global Â§5 table formatting rules
   # - Ensures TOC updated per global Â§6

3. Repeat steps 1-2

4. If PR needed (e.g., v2.5.1 release):
   /commit-push-pr
   # - Creates PR
   # - No code review needed (docs only)

5. Merge
```

#### Day Wrap-up Workflow

**For all projects:**
```bash
1. Check pending todos:
   # - Review any in-progress todos
   # - Commit unfinished work if safe stopping point

2. Create session handoff (recommended for code projects):
   "Create session handoff document"
   # Claude will generate:
   # - What was completed
   # - What's pending
   # - Context for next session
   # - Saved to: .claude/session_handoffs/YYYY-MM-DD_handoff.md

3. Save terminal output (important sessions only):
   # macOS: Shell â†’ Export Text As... â†’ YYYYMMDD_session.txt
   # Store in: ~/Desktop/[Project]/session_logs/

4. Exit cleanly:
   # - Use /bye or Ctrl+D (triggers Stop hook)
   # - Stop hook updates warmup timer
   # - Safe to close terminal
```

**Session handoff template:**
```markdown
# Session Handoff - YYYY-MM-DD

## Completed
- Feature X implemented (commit: abc123)
- Tests passing for Y
- PR #123 created

## Pending
- [ ] Fix issue Z in PR review
- [ ] Add tests for edge case W

## Context for Next Session
- Working on: [Feature name]
- Current branch: feature/xyz
- Blocked by: [If any]
- Next steps: [Specific actions]

## References
- Related PR: #123
- Decision IDs: #G47, #P12
- Files modified: src/components/X.tsx, src/utils/Y.ts
```

**Connection to Governance:**
```bash
# Session handoff links to:
# - Decision IDs tracked in Governance/decisions/
# - Plugin usage tracked in session state
# - Boundaries enforced by hooks

# Update Governance if needed:
# - New decision â†’ Add to Governance/decisions/decisions.md
# - New pattern â†’ Add to relevant guide
# - Plugin discovery â†’ Update CLAUDE_PLUGINS_REFERENCE.md
```

---

## 14. Plugin Usage FAQ & Clarifications

### 14.1 Understanding Agents

**Q: What does "/feature-dev Add rate limiting to API endpoints with Redis backend" mean?**

A: It's an example prompt showing what to type. Replace with your actual need:
```bash
/feature-dev Add user profile editing with avatar upload
/feature-dev Implement OAuth with Google and GitHub
/feature-dev Build search with Elasticsearch integration
```

**Q: Can I see agent execution logs (model, tokens, trace)?**

A: **No**. Agents are opaque boxes:
- Input: Task
- Output: Findings summary
- Metadata: Hidden

You see **what they found**, not **how they found it**.

**Q: Do I see output from all agents in terminal?**

A: **No**. Agents run in background. You see final summary only.

**Q: Can I control agent model/token limits/count?**

A: **No**. Agents auto-determine these parameters.

**Q: How do agents understand previous context?**

A: Agents read:
- Files in codebase
- Git history/blame
- Previous agent outputs (same session only)
- CLAUDE.md files (project + global)

**NO cross-session memory** - each session starts fresh.

**Q: Can I pass context to agents via Governance documents?**

A: **Yes**. Agents read CLAUDE.md files. Example:
```markdown
# CLAUDE.md
## Conventions
- All API endpoints use JWT auth
- Use Redis for caching (connection in utils/cache.ts)
- Follow REST naming: /api/v1/resources
```
code-reviewer agents will check compliance with these rules.

---

### 14.2 Automatic vs Manual Plugins

**Q: Which plugins are automatic vs manual?**

| Plugin            | Automatic? | When Triggers                | Token Tracking         |
|-------------------|------------|------------------------------|------------------------|
| Git Operations    | No         | Manual `/commit` invocation  | Status line shows ~0K  |
| security-guidance | **Yes**    | Every Edit/Write/MultiEdit   | Low cost, always active|
| frontend-design   | **Yes**    | Frontend tasks (auto-detect) | Low cost, when triggered|
| All LSPs          | **Yes**    | File edits in specific langs | Zero cost (local)      |
| feature-dev       | No         | Manual `/feature-dev` invoke | Medium cost            |
| code-review       | No         | Manual `/code-review` invoke | Medium cost            |

**How to know if automatic:**
- Read plugin's "How It Works" section
- PreToolUse/SessionStart hooks = automatic
- Commands (/commit, /feature-dev) = manual

**Q: How to track tokens per plugin?**

A: **Not available yet** (v3 candidate feature).

Current tracking:
- Status line: `ğŸŸ¢ Context: ~XK` (estimated total, not per-plugin)
- No per-plugin breakdown

**Proposed v3 enhancement:**
```
Current:  ğŸŸ¢ Hooks: 6 | ğŸŸ¢ Context: ~15K
Proposed: ğŸŸ¢ Hooks: 6 | ğŸŸ¢ Context: ~15K | ğŸ”µ Active: frontend-design
```

---

### 14.3 Cross-Session Context

**Q: How do plugins pass context across sessions?**

A: **Plugins do NOT pass context across sessions.**

Each session starts fresh. Context comes from:
- **Artifacts in codebase:** Files agents edited
- **Git history:** Commits show what was done
- **Session handoffs:** Manual (you write `session-handoff-YYYY-MM-DD.md`)
- **Plan files:** `~/.claude/plans/*.md` (you can reference in next session)

**Q: Do plugins produce artifacts automatically?**

A: **Mixed:**
- Code changes: Yes (automatic file edits)
- Documentation: No (you must ask explicitly)
- Session summaries: No (manual handoff recommended)

---

### 14.4 Daily Workflow Clarifications

**Q: What's the correct daily workflow for code projects?**

A: **Simplified workflow:**
```
1. /feature-dev Build feature (includes testing in Phase 6)
2. /commit (save progress)
3. Repeat 1-2 for more features
4. Optional: "Run pr-test-analyzer" (check test coverage)
5. /commit-push-pr (create PR)
6. /code-review (review entire PR)
7. Fix issues â†’ /commit
8. Merge
```

**DON'T:**
- Run code-review before PR exists
- Run pr-test-analyzer on every small change
- Over-invoke plugins (wasteful)

**Q: Where does testing happen in /feature-dev?**

A: **Phase 6: Quality Review**
```
/feature-dev Add user authentication
  â†“
Phase 1: Discovery
Phase 2: Exploration (code-explorer agents)
Phase 3: Questions
Phase 4: Architecture (code-architect agents)
Phase 5: Implementation â† WRITES CODE HERE
Phase 6: Quality Review â† TESTS CODE HERE (code-reviewer agents)
Phase 7: Summary
```

**Q: What's the difference between /commit and /commit-push-pr?**

| Command           | What It Does                       | When to Use            |
|-------------------|------------------------------------|------------------------|
| `/commit`         | Local commit only (doesn't push)   | During development     |
| `/commit-push-pr` | Commit + push + create PR on GitHub| When feature ready for PR |

**Example:**
```bash
# Day 1: Working on feature
/feature-dev Add authentication
/commit  # Save progress locally

# Day 2: Continue work
# More changes
/commit  # Save more progress

# Day 3: Feature done
/commit-push-pr  # Push to GitHub + create PR
```

**Q: Why run /code-review if /feature-dev already includes review?**

A: **Different scopes:**

| Tool         | Scope                  | When                | Purpose                           |
|--------------|------------------------|---------------------|-----------------------------------|
| /feature-dev | Single feature         | During development  | Build + test new feature          |
| /code-review | Entire PR (all changes)| After PR created    | Final review before merge         |

**Example:**
```bash
# You worked on 3 features over 2 days:
/feature-dev Add auth      # Phase 6 reviews auth code only
/commit

/feature-dev Add profile   # Phase 6 reviews profile code only
/commit

/feature-dev Add settings  # Phase 6 reviews settings code only
/commit

# Now create PR with ALL changes:
/commit-push-pr

# Review ENTIRE PR (all 3 features together):
/code-review  # Checks:
              # - Do all 3 features work together?
              # - Any conflicts between features?
              # - CLAUDE.md compliance across all changes?
              # - Overall code quality?
```

**Key difference:**
- **feature-dev Phase 6:** Reviews single feature in isolation
- **/code-review:** Reviews entire PR (multiple features, how they interact)

---

### 14.5 pr-test-analyzer Usage

**Q: When should I run pr-test-analyzer?**

**âœ… CORRECT - Run when:**

1. **Before creating PR (comprehensive test check):**
   ```bash
   /feature-dev Add auth
   /commit

   /feature-dev Add profile
   /commit

   # About to create PR, check test coverage:
   "Run pr-test-analyzer on all my changes"
     â†“
   Finds gaps in test coverage
     â†“
   Fix gaps
     â†“
   /commit-push-pr
   ```

2. **After PR review feedback:**
   ```
   GitHub reviewer: "Where are the edge case tests?"
     â†“
   "Run pr-test-analyzer to identify test gaps"
     â†“
   Add missing tests
     â†“
   /commit
   ```

3. **High-stakes features:**
   ```bash
   /feature-dev Add payment processing

   # Payment = critical, verify test coverage:
   "Run pr-test-analyzer"
     â†“
   Ensure all edge cases tested
     â†“
   /commit-push-pr
   ```

**âŒ WRONG - DON'T run:**
- After every small edit
- When /feature-dev Phase 6 just ran
- For non-critical changes
- On every /commit

**Q: What does "don't run on every change" mean?**

âŒ **Wasteful:**
```bash
/feature-dev Add auth
"Run pr-test-analyzer"  # â† Already covered in Phase 6

/commit
"Run pr-test-analyzer"  # â† Nothing new to test

Edit one file
"Run pr-test-analyzer"  # â† Overkill for small change
```

âœ… **Strategic:**
```bash
/feature-dev Add auth
/commit

/feature-dev Add profile
/commit

# Multiple features done, now check:
"Run pr-test-analyzer"
```

---

### 14.6 LSPs vs Review Agents

**Q: Do LSPs automatically invoke pr-test-analyzer?**

A: **NO**. Completely separate systems:

| Tool             | Type                   | Cost    | Purpose                    |
|------------------|------------------------|---------|----------------------------|
| LSPs             | Local language servers | Zero    | Type checking, autocomplete|
| pr-test-analyzer | Review agent           | Medium  | Test coverage analysis     |

LSPs are always-on (local), pr-test-analyzer is on-demand (agent).

---

### 14.7 Plugin Applicability

**Q: Are all plugins code-only?**

A: **Mostly yes, with exceptions:**

| Plugin Type       | Code Projects | BIZZ/OPS Projects | Notes                          |
|-------------------|---------------|-------------------|--------------------------------|
| commit-commands   | âœ“             | âœ“                 | Git workflow (any git repo)    |
| security-guidance | âœ“             | âœ—                 | Code security only             |
| frontend-design   | âœ“             | âœ—                 | Frontend code only             |
| feature-dev       | âœ“             | âœ—                 | Software features only         |
| code-review       | âœ“             | âœ—                 | Code PRs only                  |
| LSPs              | âœ“             | âœ—                 | Code editing only              |
| Output styling    | âœ“             | Partial           | Learning plugins (any topic)   |

**For BIZZ/OPS (Governance project):**
- âœ“ Use: commit-commands (git workflow)
- âœ“ Use: explanatory-output-style (learning)
- âœ— Don't need: feature-dev, code-review, LSPs, frontend-design

---

### 14.8 External Plugins in Daily Workflow

**Q: Where do external plugins fit in the workflow?**

```
1. /feature-dev Build feature
   â”œâ”€ greptile: Search similar code in large codebases
   â””â”€ figma: Implement design from Figma files

2. /commit (save progress)

3. Repeat 1-2

4. Optional: "Run pr-test-analyzer"

5. /commit-push-pr (create PR)
   â””â”€ linear/jira: Auto-link PR to ticket

6. /code-review (review entire PR)
   â”œâ”€ greptile: Enhanced codebase context
   â””â”€ sentry: Check if changes affect error patterns

7. Fix issues â†’ /commit

8. Merge
   â”œâ”€ vercel: Auto-deploy to production
   â”œâ”€ sentry: Monitor for new errors post-deploy
   â””â”€ slack/discord: Notify team of deployment

Post-merge (monitoring):
   â””â”€ sentry: Track runtime errors from changes
```

**External plugin value by workflow step:**

| Plugin   | Where in Workflow | Purpose                                    |
|----------|-------------------|--------------------------------------------|
| greptile | 1, 6              | Search large codebases for patterns        |
| figma    | 1                 | Convert Figma designs to code              |
| linear   | 5                 | Link PR to Linear ticket                   |
| jira     | 5                 | Link PR to Jira issue                      |
| vercel   | 8                 | Deploy to production after merge           |
| sentry   | 6, 8              | Monitor errors, check impact of changes    |
| slack    | 8                 | Notify team of deployments                 |
| notion   | Post-workflow     | Document features, create release notes    |

**Most valuable for FILICITI/COEVOLVE:**
```
âœ“ greptile  - Large codebase search
âœ“ vercel    - Deploy COEVOLVE/FILICITI
âœ“ sentry    - Monitor production errors
? figma     - If you have Figma designs
? linear    - If you use Linear for PM
```

**Not needed for Governance:**
- None (Governance = docs, no deployment/monitoring)

---

### 14.9 Templates

**Q: What about /templates? How do they relate to plugins?**

A: **Templates are separate from plugins.**

**What templates are:**
- Pre-defined file/folder structures
- Used for: "Create React component", "Create API endpoint", etc.

**Plugins vs Templates:**
```
Templates: File scaffolding (mkdir, write boilerplate)
Plugins:   Workflow automation, code analysis, review
```

Templates and plugins are **orthogonal** - they don't pass information to each other.

Templates will be covered in separate documentation if needed.

---

## 15. Plugin Recommendations by Project

### 15.1 Plugin Cost Tiers

All plugins reviewed 2026-01-07. See `PLUGIN_REVIEW_SUMMARY.md` for full analysis.

| Tier          | Plugins                                | Token Impact       | Installation Policy              |
|---------------|----------------------------------------|--------------------|----------------------------------|
| Zero (LSPs)   | 10 LSPs                                | 0 tokens           | Install all relevant to stack    |
| âœ“ Low         | 7 (commit, security, design, dev tools)| <500 tokens        | Safe to keep installed           |
| âš™ï¸ Medium      | 3 (feature-dev, code-review, pr-review)| 5K-20K per use     | Use strategically, justified     |
| ğŸ”´ HIGH        | 3 (output styling)                     | 2K-1M tokens       | ONE max, temporary only (Â§11-12) |

**Zero Cost LSPs (10):**
- typescript-lsp, pyright-lsp, gopls-lsp, rust-analyzer-lsp, csharp-lsp
- php-lsp, jdtls-lsp, clangd-lsp, swift-lsp, lua-lsp

**Low Cost (7):**
- commit-commands, security-guidance, frontend-design
- agent-sdk-dev, plugin-dev, hookify

**Medium Cost (3):**
- feature-dev, code-review, pr-review-toolkit

**HIGH Cost (3) - âš ï¸ WARNING:**
- explanatory-output-style, learning-output-style, ralph-wiggum
- See Â§11-12: ONE maximum, temporary only

---

### 15.2 FILICITI Recommendations

**Project:** React TypeScript production app

**MUST INSTALL (6):**
```
âœ“ typescript-lsp       - Zero cost, essential for TypeScript/React
âœ“ commit-commands      - Low cost, streamlines git workflow
âœ“ feature-dev          - Medium cost, justified for feature development
âœ“ code-review          - Medium cost, justified for PR quality
âœ“ frontend-design      - Low cost, automatic for React UI work
âœ“ security-guidance    - Low cost, automatic security warnings
```

**OPTIONAL (4):**
```
? pr-review-toolkit    - Use specific agents as needed (before PR)
? hookify              - If custom safety rules needed
? vercel               - If deploying to Vercel (external)
? sentry               - If error monitoring configured (external)
```

**DON'T INSTALL (3):**
```
âœ— explanatory-output-style - Production = no educational overhead
âœ— learning-output-style    - Production = no interactive learning
âœ— ralph-wiggum             - Production = controlled development
```

**Daily workflow:**
```
1. /feature-dev Build feature
2. /commit (iterate)
3. Optional: "Run pr-test-analyzer" (high-stakes only)
4. /commit-push-pr
5. /code-review
6. Fix â†’ /commit
7. Merge
```

---

### 15.3 COEVOLVE Recommendations

**Project:** React TypeScript production app

**Same as FILICITI** (both React TypeScript production apps)

**Additional considerations:**
- If using Linear: Add linear plugin (external)
- If using Figma: Add figma plugin (external)

---

### 15.4 Governance Recommendations

**Project:** Markdown documentation (this project)

**MUST INSTALL (1):**
```
âœ“ commit-commands      - Low cost, git workflow for .md files
```

**OPTIONAL (1):**
```
? hookify              - Enforce governance boundaries
                         Example: /hookify Block edits to /Volumes/, /etc/, v1_archive/
```

**DON'T INSTALL (18):**
```
âœ— typescript-lsp           - No TypeScript files
âœ— All other LSPs           - No code files
âœ— feature-dev              - No software features to build
âœ— code-review              - No code to review
âœ— pr-review-toolkit        - No code to analyze
âœ— frontend-design          - No frontend work
âœ— security-guidance        - No code security concerns
âœ— agent-sdk-dev            - No SDK apps to build
âœ— plugin-dev               - No plugins to build
âœ— explanatory-output-style - No learning phase needed
âœ— learning-output-style    - No coding skills to build
âœ— ralph-wiggum             - No autonomous project building
```

**Daily workflow:**
```
1. Edit .md files
2. /commit
3. Repeat
4. /commit-push-pr (if PR needed)
```

---

### 15.5 Plugin Installation Policy

**Based on cost tier:**

**Zero Cost (LSPs):**
- âœ“ Install all LSPs for your tech stack
- âœ“ No downside (local processing, zero tokens)
- âœ“ Auto-suggested by Claude Code based on project files

**Low Cost:**
- âœ“ Install and keep active
- âœ“ Minimal token usage (<500 per session)
- âœ“ Educational/automation benefit > cost

**Medium Cost:**
- âœ“ Install for production work
- âœ“ Use strategically (not on every small change)
- âœ“ Cost justified by quality improvement

**HIGH Cost (Â§11-12):**
- âœ— DON'T install for production work
- âœ“ Only for temporary learning phases (1-2 weeks max)
- âœ“ Install ONE maximum
- âœ— NEVER multiple simultaneously
- âœ“ Remove immediately after learning complete

---

### 15.6 Quick Reference

**Check installed plugins:**
```bash
/plugin
```

**Verify current installations:**
```
1. Check for high-cost plugins (uninstall if not learning)
2. Check for missing LSPs (install for your stack)
3. Check for redundant plugins (consolidate)
```

**Plugin review details:**
- Full analysis: `~/Desktop/Governance/PLUGIN_REVIEW_SUMMARY.md`
- Individual reviews: `~/Desktop/Governance/reviews/*.md`
- Plugin reference: `~/Desktop/Governance/CLAUDE_PLUGINS_REFERENCE.md`

---

**End of V2.5 Full Specification**

*Version: 3.0 | Updated: 2026-01-07*
